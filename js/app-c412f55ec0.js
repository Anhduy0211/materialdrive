!function(){"use strict";angular.module("materialDrive",["ngMaterial","ngLocale","ngSanitize","ngFileUpload","ui.router","materialDrive.tpls","infinite-scroll"]),angular.module("materialDrive.tpls",[])}(),function(){"use strict";angular.module("materialDrive").config(["$urlRouterProvider","$stateProvider",function(e,t){var n={google:["$q","$state","$location","google",function(e,t,n,o){var r=e.defer();return o.authorize(!0).then(function(){r.resolve(o)},function(){r.promise.then(null,function(){t.go("gate.sign",{redirect:n.url()})}),r.reject()}),r.promise}]},o={auth:["$q","$state","google",function(e,t,n){return n.prepareGapi().then(function(n){return n.authorize(!0).then(function(){t.go("drive.category",{category:"mydrive"})},function(){return e.resolve()})})}]};e.otherwise("/drive/mydrive"),t.state("gate",{url:"",templateUrl:"app/gate/gate.tpl.html",controller:"GateController as gateCtrl",resolve:o}).state("gate.sign",{url:"/sign?redirect",templateUrl:"app/gate/gate.tpl.html",controller:"GateController as gateCtrl",resolve:o}).state("drive",{url:"/drive",templateUrl:"app/drive/drive.tpl.html",controller:"DriveController as driveCtrl",resolve:n}).state("drive.category",{url:"/:category",templateUrl:"app/drive/drive-list.tpl.html",controller:["$scope","$stateParams",function(e,t){e.driveCtrl.init(t)}]}).state("drive.folder",{url:"/folder/:folderId",templateUrl:"app/drive/drive-list.tpl.html",controller:["$scope","$stateParams",function(e,t){e.driveCtrl.init(t)}]}).state("new",{url:"/new?name&mimeType&parents",template:"",controller:["$scope","$stateParams","$window",function(e,t,n){n.opener&&n.opener.callback&&n.opener.callback().then(function(e){n.location.replace(e)})}]})}]).config(["$httpProvider",function(e){e.interceptors.push(["$injector","$q",function(e,t){return{responseError:function(n){var o=e.get("$state"),r=e.get("google");return 401===n.status&&r.authorize(!0).then(function(){o.reload()},function(){o.go("gate")}),t.reject(n)}}}])}])}(),angular.module("materialDrive").constant("MimeType",{folder:"application/vnd.google-apps.folder",document:"application/vnd.google-apps.document",spreadsheet:"application/vnd.google-apps.spreadsheet",presentation:"application/vnd.google-apps.presentation"}),function(){var e=[{icon:"folder",label:"My Drive",href:"root",index:0},{icon:"people",label:"Share with me",href:"incoming",index:1},{icon:"history",label:"Recent",href:"recent",index:2},{icon:"star",label:"Starred",href:"starred",index:3},{icon:"delete",label:"Trash",href:"trash",index:4}];angular.module("materialDrive").constant("SidenavMenus",e)}(),function(){"use strict";angular.module("materialDrive").factory("notifier",[function(){var e={};return{addListener:function(t,n){var o=e[t];o||(e[t]=o=[]),o.push(n)},notify:function(t,n){var o=e[t];o&&angular.forEach(o,function(e){e.callback(n)})},removeListener:function(t,n){var o=e[t],r=0;if(o)for(r=0;r<o.length;r++)if(n===o[r].listener){o.splice(r,1);break}}}}])}(),function(){angular.module("materialDrive").factory("Util",function(){return{startsWith:function(e,t){return e.length>=t.length&&e.substring(0,t.length)===t},offset:function(e){var t=e,n=0,o=0;do{n+=t.offsetTop,o+=t.offsetLeft,t=t.offsetParent}while(!this.isNull(t));return{top:n,left:o}},isNull:function(e){return null===e},queryStringify:function(e){var t=[];return angular.forEach(e,function(n,o){angular.isUndefined(e[o])||t.push(o+"="+encodeURIComponent(n))}),t.join("&")}}})}(),function(){"use strict";var e,t="608120956255-0me03edqv60mf1eilgdjoum9qcmv4deq.apps.googleusercontent.com",n=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.metadata.readonly","https://www.googleapis.com/auth/drive.appdata","https://www.googleapis.com/auth/drive.apps.readonly","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],o={ABOUT:"https://www.googleapis.com/drive/v2/about",FILES_LIST:"https://www.googleapis.com/drive/v2/files",FILES_GET:"https://www.googleapis.com/drive/v2/files/fileId",INSERT_FILE:"https://www.googleapis.com/upload/drive/v2/files",INSERT_METADATA:"https://www.googleapis.com/drive/v2/files",FILES_COPY:"https://www.googleapis.com/drive/v2/files/%s/copy",FILES_DELETE:"https://www.googleapis.com/drive/v2/files/%s",FILES_TRASH:"https://www.googleapis.com/drive/v2/files/%s/trash",FILES_PATCH:"https://www.googleapis.com/drive/v2/files/%s"};angular.module("materialDrive").factory("google",["$http","$q","$interval","Upload","query",function(r,i,a,l,s){var c;return{prepareGapi:function(){var e=this,t=i.defer();if(e.isReady())t.resolve(e);else var n=a(function(){e.isReady()&&(a.cancel(n),t.resolve(e))},100);return t.promise},isReady:function(){return angular.isDefined(gapi.auth)},authorize:function(o){var r=i.defer();return this.prepareGapi().then(function(){var e=function(){gapi.auth.authorize({client_id:t,scope:n,immediate:!!angular.isDefined(o)&&o},function(e){e&&e.access_token?r.resolve(e):r.reject()})};c?gapi.auth.checkSessionState({client_id:t,session_state:null},function(t){t?r.resolve(c):e()}):e()}),r.promise.then(function(t){e={params:{alt:"json"},headers:{Authorization:"Bearer "+(c=t).access_token,"GData-Version":"3.0"}}})},isAuthenticated:function(){return angular.isDefined(e)},query:s,about:function(){return r.get(o.ABOUT,angular.copy(e))},filesList:function(t){var n="?q="+encodeURIComponent(t.query);return t.mimeType&&(n+=" and mimeType = '"+t.mimeType+"'"),t.pageToken&&(n+="&pageToken="+encodeURIComponent(t.pageToken)),t.maxResults&&(n+="&maxResults="+t.maxResults),t.orderBy&&(n+="&orderBy="+t.orderBy),r.get(o.FILES_LIST+n,angular.copy(e))},filesGet:function(t){return r.get([o.FILES_GET,"?fileId=",encodeURIComponent(t)].join(""),angular.copy(e))},newFile:function(t){return r.post(o.INSERT_METADATA,{title:t.title,mimeType:t.mimeType,parents:t.parents?[t.parents]:""},angular.copy(e))},getUploadEndpoint:function(t){return r({url:o.INSERT_FILE.concat("?uploadType=resumable"),method:"POST",headers:e.headers,data:{title:t.file.fileName||t.file.name,mimeType:t.file.type||"application/octet-stream",parents:t.parents?[t.parents]:""}})},uploadFile:function(t){var n=t.file.size;return l.http({url:t.endpoint,method:"PUT",headers:angular.extend({"Content-Range":["bytes ",0,"-",n-1,"/",t.file.size].join(""),"X-Upload-Content-Type":t.file.type},e.headers),data:t.file.slice(0,n)})},duplicateFile:function(t){return r.post(o.FILES_COPY.replace("%s",t.fileId),null,angular.copy(e))},moveToTrash:function(t){return r.post(o.FILES_TRASH.replace("%s",t.fileId),null,angular.copy(e))},moveTo:function(t){return r.patch([o.FILES_PATCH.replace("%s",t.fileId),"?addParents=",t.toFolderId,"&removeParents=",t.fromFolderId].join(""),null,angular.copy(e))}}}]).constant("query",{incoming:"trashed = false and not 'me' in owners and sharedWithMe",recent:"(not mimeType = 'application/vnd.google-apps.folder') and lastViewedByMeDate > '1970-01-01T00:00:00Z' and trashed = false",starred:"trashed = false and starred = true",trash:"trashed = true and explicitlyTrashed = true",folder:"trashed = false and '%s' in parents",fullText:"trashed = false and fullText contains '%s'"})}(),function(){"use strict";angular.module("materialDrive").directive("mtdContextMenu",[function(){return{restrict:"A",scope:{menuList:"=",onPopup:"&",onMenuSelected:"&"},controller:["$scope","$document","$compile","$timeout","Util",function(e,t,n,o,r){function i(){e.contextMenuState.display="none",e.$digest()}var a=this,l=angular.element(t[0].body);e.onDropdownMenuSelected=function(t){e.onMenuSelected({menu:t})},e.$on("$destroy",function(){a._menuListElem.remove(),l.off("click",i)}),e.contextMenuState={left:0,top:0,display:"none"},a.init=function(t){var s=angular.element("<mtd-dropdown></mtd-dropdown>");s.attr({class:"context-menu","menu-list":"menuList","on-menu-selected":"onDropdownMenuSelected(menu)","ng-style":"contextMenuState"}),n(s)(e),l.append(s),l.on("click",i),t.on("contextmenu",function(t){t.preventDefault();var n,i,a;e.onPopup()&&(n=t.clientX,i=t.clientY,e.contextMenuState.visibility="hidden",e.contextMenuState.display="block",e.$digest(),o(function(){a=r.offset(this),n+s[0].clientWidth>a.left+this.clientWidth&&(n-=n+s[0].clientWidth-(a.left+this.clientWidth)),i+s[0].clientHeight>a.top+this.clientHeight&&(i-=i+s[0].clientHeight-(a.top+this.clientHeight)),e.contextMenuState.left=n+"px",e.contextMenuState.top=i+"px",e.contextMenuState.visibility="visible"}.bind(this)))}),a._elem=t,a._menuListElem=s}}],controllerAs:"contextMenuCtrl",link:function(e,t,n,o){o.init(t)}}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdDropdown",[function(){return{restrict:"EA",scope:{menuList:"=",callback:"&onMenuSelected"},templateUrl:"app/common/dropdown.tpl.html",controller:["$scope",function(e){this.onMenuSelected=function(t){e.callback({menu:t})}}],controllerAs:"dropdownCtrl"}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdRightClick",["$parse","$rootScope",function(e,t){return{restrict:"A",compile:function(n,o){var r=e(o.mtdRightClick,null,!0);return function(e,n){n.on("contextmenu",function(n){var o=function(){r(e,{$event:n})};t.$$phase?e.$evalAsync(o):e.$apply(o)})}}}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdDoubleClick",["$parse","$rootScope","$timeout","$window",function(e,t,n,o){return{restrict:"A",compile:function(r,i){function a(e,n){n.on("dblclick",function(n){function o(){s(e,{$event:n})}t.$$phase?e.$evalAsync(o):e.$apply(o)})}function l(e,o){var r,i=!1;o.on("touchend",function(o){function a(){s(e,{$event:o})}i?(i=!1,Date.now()-r<300&&(t.$$phase?e.$evalAsync(a):e.$apply(a))):(r=Date.now(),i=!0,n(function(){i=!1},300))})}var s=e(i.mtdDoubleClick,null,!0);return function(e,t){"ontouchstart"in o?l(e,t):a(e,t)}}}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdFocus",["$timeout",function(e){return{link:function(t,n,o){o.$observe("mtdFocus",function(t){t&&e(function(){n.find("input").focus()})})}}}])}(),function(){"use strict";angular.module("materialDrive").controller("GateController",["$location","$state","google",function(e,t,n){this.authorize=function(){n.authorize(!1).then(function(){var n=t.params.redirect||"/drive/mydrive";e.url(n)})}}])}(),function(){"use strict";angular.module("materialDrive").controller("DriveController",["$scope","$state","$window","$q","$mdDialog","$cacheFactory","$mdMedia","notifier","google","MimeType","SidenavMenus",function(e,t,n,o,r,i,a,l,s,c,u){function d(e){var t=(s.query[e.category]||s.query.folder).replace("%s",e.folderId||u[0].href),n=[],r=w.get("menuList");switch(r.forEach(function(e){e.selected=!1}),e.category){case"incoming":r[1].selected=!0;break;case"recent":r[2].selected=!0;break;case"starred":r[3].selected=!0;break;case"trash":r[4].selected=!0;break;default:r[0].selected=!0}v.breadcrumb=y.get("breadcrumb"),v.status=y.get("status"),v.selectedItemMap={},v.currentFolder={isRoot:!0},v.contextMenuList=[{name:"Make a copy",icon:"content_copy",enabled:!0},{name:"Move to",icon:"folder_open",enabled:!0},{name:"Remove",icon:"delete",enabled:!0}],v.loaded=!1,v.itemListController={query:t,maxResults:20,orderBy:"folder,title asc",isBusy:!1,getItemAtIndex:function(e){return this.getMoreItems(e),this.items&&this.items[e]?this.items[e]:null},getMoreItems:function(e){if(!this.isBusy){var t=this;this.nextPageToken&&this.items&&this.items.length<=e+1&&(this.isBusy=!0,s.filesList({query:this.query,pageToken:this.nextPageToken,maxResults:this.maxResults,orderBy:this.orderBy}).then(function(e){var n=e.data;t.isBusy=!1,t.nextPageToken=n.nextPageToken,t.items=t.items.concat(n.items)}),this.nextPageToken="")}},getLength:function(){return this.items?this.items.length:0}},n.push(s.filesList({query:t,orderBy:v.itemListController.orderBy,maxResults:v.itemListController.maxResults})),e.folderId&&n.push(s.filesGet(e.folderId)),o.all(n).then(function(e){var t=e[0].data;2===e.length&&(v.currentFolder=e[1].data,v.currentFolder.isRoot=0===v.currentFolder.parents.length),p(),v.itemListController=angular.extend(v.itemListController,t),v.loaded=!0})}function p(){var e,t,n=function(){return i.get("sidenav").get("menuList").filter(function(e){return e.selected})[0]};v.currentFolder.isRoot?(v.breadcrumb.splice(0,v.breadcrumb.length),v.breadcrumb.push(n())):(t=[v.currentFolder],(e=function(o){s.filesGet(o.id).then(function(o){var r=o.data;r.parents[0]?(t.push(r),e(r.parents[0])):(v.breadcrumb.splice(0,v.breadcrumb.length),v.breadcrumb.push(n()),t.reverse().forEach(function(e){v.breadcrumb.push(e)}))})})(v.currentFolder.parents[0]))}function f(){angular.forEach(v.selectedItemMap,function(e){e.isSelected=!1}),v.selectedItemMap={}}function m(){var e=[];angular.forEach(v.selectedItemMap,function(t,n){e.push(s.duplicateFile({fileId:n}))}),o.all(e).then(function(){f(),d(t.params)})}function g(){var e=r.confirm().title("Will be removed").ok("Yes").cancel("Cancel"),n=[];angular.forEach(v.selectedItemMap,function(e){n.push("<p>"+e.title+"</p>")}),e.htmlContent(n.join("")),r.show(e).then(function(){var e=[];angular.forEach(v.selectedItemMap,function(t,n){e.push(s.moveToTrash({fileId:n}))}),o.all(e).then(function(){f(),d(t.params)})},angular.noop)}function h(){r.show({controller:"NavigationDialogController",controllerAs:"vm",templateUrl:"app/dialog/navigation-dialog.tpl.html",bindToController:!0,clickOutsideToClose:!0,locals:{selectedItemMap:v.selectedItemMap}}).then(function(e){var n=[];angular.forEach(v.selectedItemMap,function(t,o){n.push(s.moveTo({fileId:o,fromFolderId:t.parents[0].id,toFolderId:e.id}))}),o.all(n).then(function(){f(),d(t.params)})})}var v=this,y=i.get("drive"),w=i.get("sidenav"),$=i.get("details");v.init=d,v.onContextMenuPopup=function(){var e=0,t=!1;return angular.forEach(v.selectedItemMap,function(n){e++,n.mimeType===c.folder&&(t=!0)}),!!e&&(v.contextMenuList[0].enabled=!(e>1||t),!0)},v.onContextMenuSelected=function(e){switch(e.name){case"Make a copy":m();break;case"Remove":g();break;case"Move to":h()}},v.onItemClicked=function(e,t){t?v.selectedItemMap[e.id]?(delete v.selectedItemMap[e.id],e.isSelected=!1):(v.selectedItemMap[e.id]=e,e.isSelected=!0):v.selectedItemMap[e.id]||(f(),v.selectedItemMap[e.id]=e,e.isSelected=!0),e.isSelected&&(v.selectedItem=e)},v.onItemDoubleClicked=function(e,o){e.stopImmediatePropagation(),o.labels.trashed||(o.mimeType===c.folder?t.go("drive.folder",{category:t.params.category,folderId:o.id}):n.open(o.alternateLink))},v.upToParentFolder=function(){t.go("drive.folder",{category:t.params.category,folderId:v.currentFolder.parents[0].id})},v.isScreenSize=a.bind(a),v.isDetailsLocked=function(){return!(!a("gt-md")||!$.get("visible"))},v.MimeType=c,y||((y=i("drive")).put("breadcrumb",[]),y.put("status",{view:"list",search:!1})),w||(w=i("sidenav")).put("menuList",angular.copy(u)),$||($=i("details")),l.addListener("onNewItemCreated",{listener:v,callback:function(){d(t.params)}}),l.addListener("onFileSelected",{listener:v,callback:function(e){r.show({locals:{fileList:e.fileList,currentFolder:v.currentFolder},templateUrl:"app/dialog/upload-progress-dialog.tpls.html",escapeToClose:!1,clickOutsideToClose:!1,controllerAs:"modalCtrl",controller:"UploadProgressDialogController"}).then(function(){f(),d(t.params)})}}),e.$on("$stateChangeSuccess",function(){v.selectedItem=void 0}),e.$on("$destroy",function(){l.removeListener("onNewItemCreated",v),l.removeListener("onFileSelected",v)})}])}(),function(){"use strict";angular.module("materialDrive").controller("NavbarController",["$scope","$window","$state","$q","$cacheFactory","$mdSidenav","google","MimeType",function(e,t,n,o,r,i,a,l){var s=this,c=r.get("details");s.toggleSidenav=function(){i("sidenav").toggle()},s.toggleDetails=function(){var e=i("details");e.isOpen()||e.isLockedOpen()?(c.put("visible",!1),e.close()):(c.put("visible",!0),e.open())},s.querySearchText=function(e){var t=o.defer();return a.filesList({query:a.query.fullText.concat(" or title contains '%s'").replace("%s",e)}).then(function(e){t.resolve(e.data.items)},t.reject),t.promise},s.searchItemSelected=function(e,o){("click"===e.type||"keyup"===e.type&&13===e.keyCode)&&(o.mimeType===l.folder?n.go("drive.folder",{folderId:o.id}):t.open(o.alternateLink))},s.MimeType=l,s.status=r.get("drive").get("status"),s.breadcrumb=r.get("drive").get("breadcrumb"),e.$on("$stateChangeSuccess",function(){s.status.search=!1,s.searchText=""})}])}(),function(){"use strict";angular.module("materialDrive").controller("SidenavController",["$cacheFactory","$mdSidenav","google",function(e,t,n){var o=this,r=e.get("sidenav");o.onMenuSelect=function(e){o.selectedMenu||(o.selectedMenu=o.menuList.filter(function(e){return e.selected})[0]),o.selectedMenu.selected=!1,e.selected=!0,o.selectedMenu=e,t("sidenav").toggle()},o.menuList=r.get("menuList"),o.user=r.get("userInfo"),n.about().then(function(e){var t=e.data;t.user=angular.extend({picture:{url:"assets/images/ic_account_circle_white_24px.svg"}},t.user),o.user=t.user,r.put("userInfo",t.user)})}])}(),function(){"use strict";angular.module("materialDrive").controller("NewItemFabController",["$window","$mdDialog","$state","google","notifier","MimeType",function(e,t,n,o,r,i){var a=this;a.isExpanded=!1,a.menuList=[{name:"Document",icon:{name:"fa fa-file-word-o fa-lg",bg:"file-word-bg"},mimeType:i.document},{name:"Spreadsheet",icon:{name:"fa fa-file-excel-o fa-lg",bg:"file-spreadsheet-bg"},mimeType:i.spreadsheet},{name:"Presentation",icon:{name:"fa fa-file-powerpoint-o fa-lg",bg:"file-presentation-bg"},mimeType:i.presentation},{name:"Folder",icon:{name:"fa fa-folder fa-lg",bg:"file-bg"},mimeType:i.folder}],a.onFileSelected=function(e){e.length&&r.notify("onFileSelected",{fileList:e})},a.onMenuClick=function(l,s,c){var u=a.menuList[s],d={controller:"NameDialogController",controllerAs:"vm",templateUrl:"app/dialog/name-dialog.tpl.html",bindToController:!0,clickOutsideToClose:!0,targetEvent:l,locals:{item:u}};u.mimeType===i.folder?t.show(d).then(function(e){o.newFile({title:e,mimeType:u.mimeType,parents:c.isRoot?void 0:c}).then(function(){r.notify("onNewItemCreated")})}):(d.locals.onOk=function(t){e.callback=function(){return o.newFile({title:t,mimeType:u.mimeType,parents:c.isRoot?void 0:c}).then(function(e){return r.notify("onNewItemCreated"),e.data.alternateLink})},e.open(n.href("new"),"_blank")},t.show(d))}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdDetails",[function(){return{restrict:"EA",scope:{item:"=mtdDetailsItem"},templateUrl:"app/drive/details.tpl.html",controller:["$scope","$mdSidenav","$mdMedia","$cacheFactory",function(e,t,n,o){n("gt-md")&&o.get("details").get("visible")?t("details").open():t("details").close()}],controllerAs:"detailsCtrl"}}])}(),function(){"use strict";angular.module("materialDrive").controller("NameDialogController",["$scope","$mdDialog",function(e,t){var n=this;e.ok=function(){n.onOk&&n.onOk(n.fileName),t.hide(n.fileName)},e.cancel=function(){t.cancel()}}])}(),function(){"use strict";angular.module("materialDrive").controller("NavigationDialogController",["$mdDialog","google","MimeType","SidenavMenus",function(e,t,n,o){function r(e){t.filesList({query:t.query.folder.replace("%s",e),mimeType:n.folder}).then(function(e){var t=e.data;i.folderList=t.items})}var i=this;i.currentFolder=angular.copy(o[0],{isRoot:!0}),i.path=[i.currentFolder],i.selectFolder=function(){e.hide(i.currentFolder)},i.exapnd=function(e){i.path.push(e),i.currentFolder=e,r(e.id)},i.goToParent=function(){i.path.length>1&&i.path.pop(),i.currentFolder=i.path[i.path.length-1],r(i.currentFolder.id)},r(i.currentFolder.id)}])}(),function(){"use strict";angular.module("materialDrive").controller("UploadProgressDialogController",["$mdDialog","$mdToast","google","fileList","currentFolder",function(e,t,n,o,r){function i(){var s=o.pop();a.current={file:s,progress:0};var c=n.getUploadEndpoint({file:s,parents:r.isRoot?"":r}).then(function(e){return{endPoint:e.headers().location,file:s}});(c=c.then(function(e){var t=n.uploadFile({endpoint:e.endPoint,file:e.file}).progress(function(e){a.current.progress=Math.min(100,Math.ceil(e.loaded/e.total*100))});return a.current.promise=t,t})).then(function(){t.show(t.simple().textContent("To upload "+a.current.file.name+" was Successful!").position("top right").hideDelay(2e3)),l++,o.length>0?i():e.hide()})}var a=this,l=0;a.abort=function(){a.current.promise&&(o.length=0,a.current.promise.abort()),l>0?e.hide():e.cancel()},i()}])}();