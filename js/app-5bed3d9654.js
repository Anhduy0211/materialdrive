!function(){"use strict";angular.module("materialDrive",["ngMaterial","ngLocale","ngFileUpload","ui.router","materialDrive.tpls","infinite-scroll"]),angular.module("materialDrive.tpls",[])}(),function(){"use strict";function e(e,t){var n={google:["$q","$state","$location","Google",function(e,t,n,o){var r=e.defer();return o.authorize(!0).then(function(){r.resolve(o)},function(){r.promise.then(null,function(){t.go("gate.sign",{redirect:n.url()})}),r.reject()}),r.promise}]},o={auth:["$q","$state","Google",function(e,t,n){return n.prepareGapi().then(function(n){return n.authorize(!0).then(function(){t.go("drive.category",{category:"mydrive"})},function(){return e.resolve()})})}]};e.otherwise("/drive/mydrive"),t.state("gate",{url:"",templateUrl:"app/gate/gate.tpl.html",controller:"GateController as gateCtrl",resolve:o}).state("gate.sign",{url:"/sign?redirect",templateUrl:"app/gate/gate.tpl.html",controller:"GateController as gateCtrl",resolve:o}).state("drive",{url:"/drive",templateUrl:"app/drive/drive.tpl.html",controller:"DriveController as driveCtrl",resolve:n}).state("drive.category",{url:"/:category",templateUrl:"app/drive/drive-list.tpl.html",controller:["$scope","$stateParams",function(e,t){e.driveCtrl.init(t)}]}).state("drive.folder",{url:"/folder/:folderId",templateUrl:"app/drive/drive-list.tpl.html",controller:["$scope","$stateParams",function(e,t){e.driveCtrl.init(t)}]})}function t(e){e.interceptors.push(["$injector","$q",function(e,t){return{responseError:function(n){var o=e.get("$state"),r=e.get("Google");return 401===n.status&&r.authorize(!0).then(function(){o.reload()},function(){o.go("gate")}),t.reject(n)}}}])}angular.module("materialDrive").config(["$urlRouterProvider","$stateProvider",e]).config(["$httpProvider",t])}(),function(){function e(){return{startsWith:function(e,t){return e.length>=t.length&&e.substring(0,t.length)===t},offset:function(e){for(var t=e,n=0,o=0;"undefined"!=typeof t.offsetTop;)n+=t.offsetTop,o+=t.offsetLeft,t=t.parentNode;return{top:n,left:o}}}}angular.module("materialDrive").factory("Util",e)}(),function(){"use strict";function e(e,i,a,l,s,c){var u;return{prepareGapi:function(){var e=this,t=i.defer();if(e.isReady())t.resolve(e);else var n=a(function(){e.isReady()&&(a.cancel(n),t.resolve(e))},100);return t.promise},isReady:function(){return angular.isDefined(gapi.auth)},authorize:function(e){var r=i.defer();return this.prepareGapi().then(function(){var t=function(){gapi.auth.authorize({client_id:n,scope:o,immediate:angular.isDefined(e)?e:!1},function(e){e&&e.access_token?r.resolve(e):r.reject()})};u?gapi.auth.checkSessionState({client_id:n,session_state:null},function(e){e?t():r.resolve(u)}):t()}),r.promise.then(function(e){u=e,t={params:{alt:"json"},headers:{Authorization:"Bearer "+u.access_token,"GData-Version":"3.0"}}})},isAuthenticated:function(){return angular.isDefined(t)},mimeType:c,query:s,about:function(){return e.get(r.ABOUT,angular.copy(t))},filesList:function(n){var o="?q="+encodeURIComponent(n.query);return n.mimeType&&(o+=" and mimeType = '"+n.mimeType+"'"),n.pageToken&&(o+="&pageToken="+encodeURIComponent(n.pageToken)),n.maxResults&&(o+="&maxResults="+n.maxResults),n.orderBy&&(o+="&orderBy="+n.orderBy),e.get(r.FILES_LIST+o,angular.copy(t))},filesGet:function(n){return e.get([r.FILES_GET,"?fileId=",encodeURIComponent(n)].join(""),angular.copy(t))},newFile:function(n){return e.post(r.INSERT_METADATA,{title:n.title,mimeType:n.mimeType,parents:n.parents?[n.parents]:""},angular.copy(t))},getUploadEndpoint:function(n){return e({url:r.INSERT_FILE.concat("?uploadType=resumable"),method:"POST",headers:t.headers,data:{title:n.file.fileName||n.file.name,mimeType:n.file.type||"application/octet-stream",parents:n.parents?[n.parents]:""}})},uploadFile:function(e){var n=0,o=e.file.size;return l.http({url:e.endpoint,method:"PUT",headers:angular.extend({"Content-Range":["bytes ",n,"-",o-1,"/",e.file.size].join(""),"X-Upload-Content-Type":e.file.type},t.headers),data:e.file.slice(n,o)})},duplicateFile:function(n){return e.post(r.FILES_COPY.replace("%s",n.fileId),null,angular.copy(t))},moveToTrash:function(n){return e.post(r.FILES_TRASH.replace("%s",n.fileId),null,angular.copy(t))},moveTo:function(n){return e.patch([r.FILES_PATCH.replace("%s",n.fileId),"?addParents=",n.toFolderId,"&removeParents=",n.fromFolderId].join(""),null,angular.copy(t))}}}var t,n="608120956255-0me03edqv60mf1eilgdjoum9qcmv4deq.apps.googleusercontent.com",o=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.metadata.readonly","https://www.googleapis.com/auth/drive.appdata","https://www.googleapis.com/auth/drive.apps.readonly","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],r={ABOUT:"https://www.googleapis.com/drive/v2/about",FILES_LIST:"https://www.googleapis.com/drive/v2/files",FILES_GET:"https://www.googleapis.com/drive/v2/files/fileId",INSERT_FILE:"https://www.googleapis.com/upload/drive/v2/files",INSERT_METADATA:"https://www.googleapis.com/drive/v2/files",FILES_COPY:"https://www.googleapis.com/drive/v2/files/%s/copy",FILES_DELETE:"https://www.googleapis.com/drive/v2/files/%s",FILES_TRASH:"https://www.googleapis.com/drive/v2/files/%s/trash",FILES_PATCH:"https://www.googleapis.com/drive/v2/files/%s"};angular.module("materialDrive").factory("Google",["$http","$q","$interval","Upload","query","mimeType",e]).constant("query",{incoming:"trashed = false and not 'me' in owners and sharedWithMe",recent:"(not mimeType = 'application/vnd.google-apps.folder') and lastViewedByMeDate > '1970-01-01T00:00:00Z' and trashed = false",starred:"trashed = false and starred = true",trash:"trashed = true and explicitlyTrashed = true",folder:"trashed = false and '%s' in parents",fullText:"trashed = false and fullText contains '%s'"}).constant("mimeType",{folder:"application/vnd.google-apps.folder",document:"application/vnd.google-apps.document",spreadsheet:"application/vnd.google-apps.spreadsheet",presentation:"application/vnd.google-apps.presentation"})}(),function(){"use strict";function e(){var e={};return{addListener:function(t,n){var o=e[t];o||(e[t]=o=[]),o.push(n)},notify:function(t,n){var o=e[t];o&&angular.forEach(o,function(e){e.callback(n)})},removeListener:function(t,n){var o=e[t],r=0;if(o)for(r=0;r<o.length;r++)if(n===o[r].listener){o.splice(r,1);break}}}}angular.module("materialDrive").factory("notifier",[e])}(),function(){"use strict";function e(e,t,n,o){function r(){o.authorize(!1).then(function(){var e=n.params.redirect||"/drive/mydrive";t.url(e)})}var i=this;i.authorize=r}angular.module("materialDrive").controller("GateController",["$scope","$location","$state","Google",e])}(),function(){"use strict";function e(e,t,n,o,r,i,a,l){function s(){a("sidenav").toggle()}function c(){var e=a("details");e.isOpen()||e.isLockedOpen()?(m.put("visible",!1),e.close()):(m.put("visible",!0),e.open())}function u(e){var t=r.defer();return l.filesList({query:l.query.fullText.concat(" or title contains '%s'").replace("%s",e)}).then(function(e){t.resolve(e.data.items)},t.reject),t.promise}function d(){p.selectedItem&&(p.selectedItem.mimeType===l.mimeType.folder?o.go("drive.folder",{folderId:p.selectedItem.id}):t.open(p.selectedItem.alternateLink))}var p=this,m=i.get("details");p.toggleSidenav=s,p.toggleDetails=c,p.querySearchText=u,p.searchItemSelected=d,p.status=i.get("drive").get("status"),p.breadcrumb=i.get("drive").get("breadcrumb"),e.$on("$stateChangeSuccess",function(){p.status.search=!1,p.searchText=""})}function t(e,t){function n(e){o.selectedMenu||(o.selectedMenu=o.menuList.filter(function(e){return e.selected})[0]),o.selectedMenu.selected=!1,e.selected=!0,o.selectedMenu=e}var o=this,r=e.get("sidenav");o.onMenuSelect=n,o.menuList=r.get("menuList"),o.user=r.get("userInfo"),t.about().success(function(e){o.user=e.user,r.put("userInfo",e.user)})}function n(e,t,n,o,r,i,a,l,s,c,u,d){function p(e){var t=(u.query[e.category]||u.query.folder).replace("%s",e.folderId||"root"),n=[],r=C.get("menuList");switch(e.category){case"incoming":r[1].selected=!0;break;case"recent":r[2].selected=!0;break;case"starred":r[3].selected=!0;break;case"trash":r[4].selected=!0;break;default:r[0].selected=!0}F.breadcrumb=M.get("breadcrumb"),F.status=M.get("status"),F.selectedItemMap={},F.currentFolder={isRoot:!0},F.contextMenuList=[{name:"Make a copy",icon:"content_copy",enabled:!0},{name:"Move to",icon:"folder_open",enabled:!0},{name:"Remove",icon:"delete",enabled:!0}],F.loaded=!1,F.itemListController={query:t,maxResults:20,orderBy:"folder,title asc",isBusy:!1,getItemAtIndex:function(e){return this.getMoreItems(e),this.items&&this.items[e]?this.items[e]:null},getMoreItems:function(e){if(!this.isBusy){var t=this;this.nextPageToken&&this.items&&this.items.length<=e+1&&(this.isBusy=!0,u.filesList({query:this.query,pageToken:this.nextPageToken,maxResults:this.maxResults,orderBy:this.orderBy}).success(function(e){t.isBusy=!1,t.nextPageToken=e.nextPageToken,t.items=t.items.concat(e.items)}),this.nextPageToken="")}},getLength:function(){return this.items?this.items.length:0}},n.push(u.filesList({query:t,orderBy:F.itemListController.orderBy,maxResults:F.itemListController.maxResults})),e.folderId&&n.push(u.filesGet(e.folderId)),o.all(n).then(function(e){var t=e[0].data;2===e.length&&(F.currentFolder=e[1].data,F.currentFolder.isRoot=0===F.currentFolder.parents.length),m(),F.itemListController=angular.extend(F.itemListController,t),F.loaded=!0})}function m(){var e,t,n=function(){return a.get("sidenav").get("menuList").filter(function(e){return e.selected})[0]};F.currentFolder.isRoot?(F.breadcrumb.splice(0,F.breadcrumb.length),F.breadcrumb.push(n())):(t=[F.currentFolder],(e=function(o){u.filesGet(o.id).success(function(o){o.parents[0]?(t.push(o),e(o.parents[0])):(F.breadcrumb.splice(0,F.breadcrumb.length),F.breadcrumb.push(n()),t.reverse().forEach(function(e){F.breadcrumb.push(e)}))})})(F.currentFolder.parents[0]))}function f(e,t){t?F.selectedItemMap[e.id]?(delete F.selectedItemMap[e.id],e.isSelected=!1):(F.selectedItemMap[e.id]=e,e.isSelected=!0):F.selectedItemMap[e.id]||(b(),F.selectedItemMap[e.id]=e,e.isSelected=!0),e.isSelected&&(F.selectedItem=e)}function g(e){e.labels.trashed||(e.mimeType===u.mimeType.folder?t.go("drive.folder",{category:t.params.category,folderId:e.id}):n.open(e.alternateLink))}function h(){t.go("drive.folder",{category:t.params.category,folderId:F.currentFolder.parents[0].id})}function v(e){u.newFile({title:e.name,mimeType:e.mimeType,parents:F.currentFolder.isRoot?"":F.currentFolder}).success(function(e){e.mimeType!==u.mimeType.folder&&n.open(e.alternateLink),p(t.params)})}function y(e){r.show({locals:{currentFolder:F.currentFolder},templateUrl:"app/drive/upload-progress-dialog.tpls.html",escapeToClose:!1,clickOutsideToClose:!1,controllerAs:"vm",controller:function(n,r,i){var a=this,l=[],s=[];a.abort=function(){a.prepared&&s.forEach(function(e){e.abort()}),r.cancel()},e.fileList.forEach(function(e){var t=u.getUploadEndpoint({file:e,parents:i.isRoot?"":i}).then(function(t){return{response:t,file:e}});l.push(t)}),o.all(l).then(function(e){e.forEach(function(e){s.push(u.uploadFile({endpoint:e.response.headers().location,file:e.file}))}),o.all(s).then(function(){r.hide(),b(),p(t.params)}),a.prepared=!0})}})}function T(){var e=0,t=!1;return angular.forEach(F.selectedItemMap,function(n){e++,n.mimeType===u.mimeType.folder&&(t=!0)}),e?(e>1||t?F.contextMenuList[0].enabled=!1:F.contextMenuList[0].enabled=!0,!0):!1}function w(e){switch(e.name){case"Make a copy":I();break;case"Remove":$();break;case"Move to":L()}}function b(){angular.forEach(F.selectedItemMap,function(e){e.isSelected=!1}),F.selectedItemMap={}}function I(){var e=[];angular.forEach(F.selectedItemMap,function(t,n){e.push(u.duplicateFile({fileId:n}))}),o.all(e).then(function(){b(),p(t.params)})}function $(){var e=r.confirm().title("Will be removed").ok("Yes").cancel("Cancel"),n="";angular.forEach(F.selectedItemMap,function(e){n=[n,'"',e.title,'", '].join("")}),e.content(n.substring(0,n.lastIndexOf(","))),r.show(e).then(function(){var e=[];angular.forEach(F.selectedItemMap,function(t,n){e.push(u.moveToTrash({fileId:n}))}),o.all(e).then(function(){b(),p(t.params)})})}function L(){r.show({controller:"NavigationDialogController",controllerAs:"vm",templateUrl:"app/drive/navigation-dialog.tpl.html",bindToController:!0,clickOutsideToClose:!0,locals:{selectedItemMap:F.selectedItemMap},resolve:function(){return{$injector:i}}}).then(function(e){var n=[];angular.forEach(F.selectedItemMap,function(t,o){n.push(u.moveTo({fileId:o,fromFolderId:t.parents[0].id,toFolderId:e.id}))}),o.all(n).then(function(){b(),p(t.params)})})}function S(){return!(!l("gt-md")||!x.get("visible"))}var F=this,M=a.get("drive"),C=a.get("sidenav"),x=a.get("details");F.init=p,F.onContextMenuPopup=T,F.onContextMenuSelected=w,F.onItemClicked=f,F.onItemDoubleClicked=g,F.upToParentFolder=h,F.isScreenSize=l,F.isDetailsLocked=S,F.mimeType=d,M||(M=a("drive"),M.put("breadcrumb",[]),M.put("status",{view:"list",search:!1})),C||(C=a("sidenav"),C.put("menuList",[{icon:"folder",label:"My Drive",href:"mydrive",index:0},{icon:"people",label:"Share with me",href:"incoming",index:1},{icon:"history",label:"Recent",href:"recent",index:2},{icon:"star",label:"Starred",href:"starred",index:3},{icon:"delete",label:"Trash",href:"trash",index:4}])),x||(x=a("details")),c.addListener("newItem",{listener:F,callback:v}),c.addListener("upload",{listener:F,callback:y}),e.$on("$stateChangeSuccess",function(){F.selectedItem=void 0}),e.$on("$destroy",function(){c.removeListener("newItem",F),c.removeListener("upload",F)})}function o(e,t,n,o){function r(){t.hide(s.currentFolder)}function i(){s.path.length>1&&s.path.pop(),s.currentFolder=s.path[s.path.length-1],l(s.currentFolder.id)}function a(e){s.path.push(e),s.currentFolder=e,l(e.id)}function l(e){o.filesList({query:o.query.folder.replace("%s",e),mimeType:o.mimeType.folder}).success(function(e){s.folderList=e.items})}var s=this;s.currentFolder={title:"My Drive",id:"root",isRoot:!0},s.path=[s.currentFolder],s.selectFolder=r,s.exapnd=a,s.goToParent=i,l(s.currentFolder.id)}angular.module("materialDrive").controller("NavbarController",["$scope","$window","$document","$state","$q","$cacheFactory","$mdSidenav","Google",e]).controller("SidenavController",["$cacheFactory","Google",t]).controller("DriveController",["$scope","$state","$window","$q","$mdDialog","$injector","$cacheFactory","$mdMedia","$mdSidenav","notifier","Google","mimeType",n]).controller("NavigationDialogController",["$scope","$mdDialog","$q","Google",o])}(),function(){"use strict";function e(e,t){return{compile:function(n,o){var r=e(o.mtdRightClick,null,!0);return function(e,n){n.on("contextmenu",function(n){var o=function(){r(e,{$event:n})};t.$$phase?e.$evalAsync(o):e.$apply(o)})}}}}function t(e){return{link:function(t,n,o){o.$observe("mtdFocus",function(t){t&&e(function(){n.find("input").focus()})})}}}function n(e){return{scope:{item:"=mtdDetails"},templateUrl:"app/drive/details.tpl.html",controller:["$scope","$mdSidenav","$mdMedia","$cacheFactory",function(t,n,o,r){function i(){return t.item&&t.item.mimeType===e.folder}var a=this;a.isFolder=i,o("gt-md")&&r.get("details").get("visible")?n("details").open():n("details").close()}],controllerAs:"detailsCtrl"}}angular.module("materialDrive").directive("mtdRightClick",["$parse","$rootScope",e]).directive("mtdFocus",["$timeout",t]).directive("mtdDetails",["mimeType",n])}(),function(){"use strict";function e(e,t,n,o,r){var i=this;i.isExpanded=!0,n(function(){i.isExpanded=!1,n(function(){i.show=!0})}),i.menuList=[{name:"Document",icon:{name:"fa fa-file-word-o fa-lg",bg:"file-word-bg"},mimeType:o.mimeType.document},{name:"Spreadsheet",icon:{name:"fa fa-file-excel-o fa-lg",bg:"file-spreadsheet-bg"},mimeType:o.mimeType.spreadsheet},{name:"Presentation",icon:{name:"fa fa-file-powerpoint-o fa-lg",bg:"file-presentation-bg"},mimeType:o.mimeType.presentation},{name:"Folder",icon:{name:"fa fa-folder fa-lg",bg:"file-bg"},mimeType:o.mimeType.folder}],i.onFileSelected=function(e){e.length&&r.notify("upload",{fileList:e})},i.menuClick=function(e,n){var o=i.menuList[n];t.show({controller:"NameDialogController",controllerAs:"vm",templateUrl:"app/drive/name-dialog.tpl.html",bindToController:!0,clickOutsideToClose:!0,targetEvent:e,locals:{item:o},onComplete:function(e,t){t.find("input").focus()}}).then(function(e){r.notify("newItem",{name:e,mimeType:o.mimeType})})}}function t(e,t){var n=this;e.ok=function(){t.hide(n.fileName)},e.cancel=function(){t.cancel()}}angular.module("materialDrive").controller("NewItemFabController",["$scope","$mdDialog","$timeout","Google","notifier",e]).controller("NameDialogController",["$scope","$mdDialog",t])}(),function(){"use strict";angular.module("materialDrive").directive("mtdContextMenu",[function(){function e(e,t,n,o){var r=this;e.onDropdownMenuSelected=function(t){e.onMenuSelected({menu:t})},e.$on("$destroy",function(){r._menuListElem.remove()}),e.contextMenuState={left:0,top:0,visibility:"hidden"},r.init=function(i){var a=angular.element("<mtd-dropdown></mtd-dropdown>"),l=angular.element(t[0].body);a.attr({"class":"context-menu","menu-list":"menuList","on-menu-selected":"onDropdownMenuSelected(menu)","ng-style":"contextMenuState"}),n(a)(e),l.append(a),l.on("click",function(){e.contextMenuState.display="none",e.$digest()}),i.on("contextmenu",function(t){var n,r,i;e.onPopup()&&(n=t.clientX,r=t.clientY,i=o.offset(this),n+a[0].clientWidth>i.left+this.clientWidth&&(n-=n+a[0].clientWidth-(i.left+this.clientWidth)),r+a[0].clientHeight>i.top+this.clientHeight&&(r-=r+a[0].clientHeight-(i.top+this.clientHeight)),e.contextMenuState.left=n+"px",e.contextMenuState.top=r+"px",e.contextMenuState.visibility="visible",e.contextMenuState.display="block"),e.$digest(),t.preventDefault()}),r._elem=i,r._menuListElem=a}}function t(e,t,n,o){o.init(t)}return{restrict:"A",scope:{menuList:"=",onPopup:"&",onMenuSelected:"&"},controller:["$scope","$document","$compile","Util",e],controllerAs:"contextMenuCtrl",link:t}}])}(),function(){"use strict";angular.module("materialDrive").directive("mtdDropdown",[function(){function e(e){this.onMenuSelected=function(t){e.callback({menu:t})}}return{restrict:"EA",scope:{menuList:"=",callback:"&onMenuSelected"},templateUrl:"app/components/dropdown.tpl.html",controller:["$scope",e],controllerAs:"dropdownCtrl"}}])}();